# Predictive Analysis

### Importing Necessary Libraries

```{r}
# load library here
library(DBI)
library(RSQLite)
```

### **Loading the Dataset**

Load the cleaned data from NA_processing Rmd. Call this function whenver we need this version of dataset

```{r}
# use fetched database to clean the data
# then return a data frame for predictive analysis
clean_data <- function() {
  # connect to db and read table
  conn <- dbConnect(SQLite(), "anime_full_database.sqlite")
  
  anime_data <- dbReadTable(conn, "anime_full")
  
  selected_attributes <- c("mal_id", "title", "type", "episodes", "status", 
                          "rating", "score", "scored_by", "rank", "popularity", 
                          "members", "favorites", "genres", "studios", "producers")
  
  anime_data <- anime_data[, selected_attributes]
 
  anime_data <- anime_data[!is.na(anime_data$title), ] # Keep only rows where title is NOT missing
  
  anime_data <- anime_data[!is.na(anime_data$genres),] # Keep only rows where genres is NOT missing
  
  return(anime_data)
}

mydata <- clean_data()
# summary(mydata) # uncomment this if need
colnames(anime_data)

```

Before implement Predictive Model, we do one hot encoding for genres

```{r}
# implement one hot encoding here
# top 10 genre
top10 <- c("Comedy", "Action", "Fantasy", "Adventure", "Sci-Fi", "Drama", "Romance", "Hentai", "Supernatural", "Slice of Life")

orig_data <- anime_data %>% 
  mutate(row_id = row_number())
onehot <- orig_data %>%
  mutate(genres_list = strsplit(genres, ",\\s*")) %>%
  unnest(genres_list) %>%
  mutate(dummy = 1) %>%
  pivot_wider(id_cols = row_id, names_from = genres_list, values_from = dummy, values_fill = list(dummy = 0))
onehotdata <- left_join(orig_data, onehot, by = "row_id")
onehotdata
```

Use cross-validation to split training and testing set for better performance.

```{r}
# implement cv here
```

## Linear Regression Predictive Analysis

```{r}
# lm here
```

## XGBoost Predictive Analysis

```{r}

```
